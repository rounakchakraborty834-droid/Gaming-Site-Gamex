import{d as e,e as t,W as i,g as s,P as n,f as r,m as a,L as o,C as d}from"./three.module.c9112413.js";class x{constructor(x,{shader:c,width:f=512,height:l=512,format:u=r,type:h=a,minFilter:v=o,magFilter:y=o,wrapS:m=d,wrapT:p=d,renderOptions:R={target:null}}={}){this.renderer=x,this.shader=c,this.scene=new e,this.orthoCamera=new t(f/-2,f/2,l/2,l/-2,1e-5,1e3),this.renderOptions=R;const z={wrapS:m,wrapT:p,minFilter:v,magFilter:y,format:u,type:h};this.fbo={read:new i(f,l,z),write:new i(f,l,z),swap:()=>{[this.fbo.read,this.fbo.write]=[this.fbo.write,this.fbo.read],this.uniform.value=this.fbo.read.texture}},this.shader&&(this.mesh=new s(new n(1,1),this.shader),this.mesh.scale.set(f,l,1),this.scene.add(this.mesh))}setSize(e,t){this.fbo.read.setSize(e,t),this.fbo.write.setSize(e,t),this.orthoCamera.left=-e/2,this.orthoCamera.right=e/2,this.orthoCamera.top=t/2,this.orthoCamera.bottom=-t/2,this.orthoCamera.updateProjectionMatrix(),this.mesh&&this.mesh.scale.set(e,t,1)}dispose(){this.scene.traverse((e=>{var t,i,s,n,r,a;e.removeFromParent(),null==(n=null==(s=null==(i=null==(t=e.material)?void 0:t.uniforms)?void 0:i.tMap)?void 0:s.value)||n.dispose(),null==(r=e.material)||r.dispose(),null==(a=e.geometry)||a.dispose(),e=void 0}));for(const e in this.fbo)this.fbo[e]instanceof i&&(this.fbo[e].dispose(),this.fbo[e]=void 0);this.fbo=void 0}get texture(){return this.fbo.read.texture}render({final:e=!0,clear:t}){e?this.renderer.render(this.scene,this.orthoCamera):(this.renderer.setRenderTarget(this.fbo.read),t&&this.renderer.clear(),this.renderer.render(this.scene,this.orthoCamera),this.renderer.setRenderTarget(this.renderOptions.target))}}const c="#define GLSLIFY 1\nvec2 coord(in vec2 p){p=p/uResolution.xy;if(uResolution.x>uResolution.y){p.x*=uResolution.x/uResolution.y;p.x+=(uResolution.y-uResolution.x)/uResolution.y/2.0;}else{p.y*=uResolution.y/uResolution.x;p.y+=(uResolution.x-uResolution.y)/uResolution.x/2.0;}p-=0.5;p*=vec2(-1.0,1.0);return p;}\n#define rx 1.0 / min(uResolution.x, uResolution.y)\n#define uv0 gl_FragCoord.xy / uResolution.xy\n#define st0 coord(gl_FragCoord.xy)\n#define mx coord(uPointer)\n",f="#define GLSLIFY 1\nvec2 pos(in float x,in float y){return st0+vec2(x*rx,y*rx);}vec2 pos(in float x){return pos(x,x);}vec2 pos(in vec2 p){return pos(p.x,p.y);}float size(in float x){return x*rx;}vec2 size(in float x,in float y){return vec2(x*rx,y*rx);}",l="#define GLSLIFY 1\n#ifndef FNC_ROTATE2D\n#define FNC_ROTATE2D\nmat2 rotate2d(in float radians){float c=cos(radians);float s=sin(radians);return mat2(c,-s,s,c);}\n#endif\n#ifndef FNC_ROTATE4D\n#define FNC_ROTATE4D\nmat4 rotate4d(in vec3 axis,in float radians){axis=normalize(axis);float s=sin(radians);float c=cos(radians);float oc=1.0-c;return mat4(oc*axis.x*axis.x+c,oc*axis.x*axis.y-axis.z*s,oc*axis.z*axis.x+axis.y*s,0.0,oc*axis.x*axis.y+axis.z*s,oc*axis.y*axis.y+c,oc*axis.y*axis.z-axis.x*s,0.0,oc*axis.z*axis.x-axis.y*s,oc*axis.y*axis.z+axis.x*s,oc*axis.z*axis.z+c,0.0,0.0,0.0,0.0,1.0);}\n#endif\n#ifndef FNC_ROTATE\n#define FNC_ROTATE\nvec2 rotate(in vec2 st,in float radians,in vec2 center){return rotate2d(radians)*(st-center)+center;}vec2 rotate(in vec2 st,in float radians){\n#ifdef CENTER_2D\nreturn rotate(st,radians,CENTER_2D);\n#else\nreturn rotate(st,radians,vec2(.5));\n#endif\n}vec3 rotate(in vec3 xyz,in float radians,in vec3 axis,in vec3 center){return(rotate4d(axis,radians)*vec4(xyz-center,1.)).xyz+center;}vec3 rotate(in vec3 xyz,in float radians,in vec3 axis){\n#ifdef CENTER_3D\nreturn rotate(xyz,radians,axis,CENTER_3D);\n#else\nreturn rotate(xyz,radians,axis,vec3(0.));\n#endif\n}vec4 rotate(in vec4 xyzw,in float radians,in vec3 axis,in vec4 center){return rotate4d(axis,radians)*(xyzw-center)+center;}vec4 rotate(in vec4 xyzw,in float radians,in vec3 axis){\n#ifdef CENTER_4D\nreturn rotate(xyzw,radians,axis,CENTER_4D);\n#else\nreturn rotate(xyzw,radians,axis,vec4(0.));\n#endif\n}\n#endif\n";export{x as S,f as a,l as b,c as g};
